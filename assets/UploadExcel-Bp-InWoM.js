import{r as R,u as _}from"./xlsx-PuJ-vIrN.js";import{_ as A,r as c,c as m,b as g,e as w,g as N,f as y,w as C,a as D,F as H,i as I,j as L,l as M}from"./index-CoWgc5c_.js";const P={__name:"index",props:{expectedHeader:Array,beforeUpload:Function,onSuccess:Function},setup(k){const a=k,r=c(!1),u=c({header:null,results:null}),d=c(null),x=e=>/\.(xlsx|xls|csv)$/.test(e.name),l=e=>{if(console.log("+"),e.stopPropagation(),e.preventDefault(),r.value)return;const t=e.dataTransfer.files;if(t.length!==1){alert("一次只能拖曳一個檔案");return}const o=t[0];if(!x(o)){alert("僅支援.xlsx, .xls, .csv 以上檔案");return}s(o)},i=e=>{console.log("-"),e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},h=()=>{var e;(e=d.value)==null||e.click()},v=e=>{const o=e.target.files[0];o&&s(o)},s=e=>{if(d.value.value=null,console.log("props.beforeUpload:",a.beforeUpload),!a.beforeUpload){U(e);return}a.beforeUpload(e)&&U(e)},U=e=>{r.value=!0;const t=new FileReader;t.onload=o=>{const b=o.target.result,n=R(b,{type:"array"}),p=n.SheetNames[0],f=n.Sheets[p],B=S(f),F=_.sheet_to_json(f);E({header:B,results:F}),r.value=!1},t.readAsArrayBuffer(e)},E=({header:e,results:t})=>{var o;u.value.header=e,u.value.results=t,(o=a.onSuccess)==null||o.call(a,u.value)},S=e=>{const t=[],o=_.decode_range(e["!ref"]),b=o.s.r;for(let n=o.s.c;n<=o.e.c;++n){const p=e[_.encode_cell({c:n,r:b})];let f="UNKNOWN "+n;p&&p.t&&(f=_.format_cell(p)),t.push(f)}return t};return(e,t)=>{const o=D("el-button");return g(),m("div",null,[w("input",{ref_key:"fileInputRef",ref:d,class:"excel-upload-input",type:"file",accept:".xlsx, .xls",onChange:v},null,544),w("div",{class:"drop",onDrop:l,onDragover:i,onDragenter:i},[t[1]||(t[1]=N(" Drop excel file here or ")),y(o,{loading:r.value,style:{"margin-left":"16px"},type:"primary",onClick:h},{default:C(()=>t[0]||(t[0]=[N(" Browse ")])),_:1},8,["loading"])],32)])}}},T=A(P,[["__scopeId","data-v-5abab64f"]]),V={class:"app-container"},$={__name:"UploadExcel",setup(k){const a=c([]),r=c([]),u=c(["Name","Age","Email"]),d=l=>{if(console.log("beforeUpload:",l),l.size/1024/1024<1)return!0;M.error("Please do not upload files larger than 1m in size.")},x=l=>{a.value=l.results,r.value=l.header};return(l,i)=>{const h=D("el-table-column"),v=D("el-table");return g(),m("div",V,[y(T,{"on-success":x,"before-upload":d,"expected-header":u.value},null,8,["expected-header"]),y(v,{data:a.value,border:"","highlight-current-row":"",style:{width:"100%","margin-top":"20px"}},{default:C(()=>[(g(!0),m(H,null,I(r.value,s=>(g(),L(h,{key:s,prop:s,label:s},null,8,["prop","label"]))),128))]),_:1},8,["data"])])}}};export{$ as default};
